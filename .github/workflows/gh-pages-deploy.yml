 name: Deploy to github pages
 on:
   push:
     branches:
       - main
 jobs:
   gh-pages-deploy:
     name: Deploying to gh-pages
     runs-on: ubuntu-latest
     steps:
       - name: Checkout branch
         uses: actions/checkout@v3

       - name: Setup pnpm
         uses: pnpm/action-setup@v2
         with:
           version: 8

       - name: Setup Node.js
         uses: actions/setup-node@v3
         with:
           node-version: 18
           cache: 'pnpm'

       - name: Install dependencies
         run: pnpm install --frozen-lockfile

       - name: Build main site
         run: pnpm build

       - name: Build Storybook
         run: pnpm build-storybook

       - name: Copy Storybook to dist
         run: cp -r storybook-static dist/storybook

       - name: Deploy to GitHub Pages
         uses: peaceiris/actions-gh-pages@v3
         with:
           github_token: ${{ secrets.GITHUB_TOKEN }}
           publish_dir: ./dist
           publish_branch: gh-pages